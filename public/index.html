<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" charset="utf-8">
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.grey-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="app" class="demo-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100">
    <header class="demo-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800">
      <div class="mdl-layout__header-row">
        <span class="mdl-layout-title">Text To Voice</span>
        <div class="mdl-layout-spacer"></div>
      </div>
    </header>
    <main class="demo-main mdl-layout__content">
      <div class="demo-container mdl-grid">
        <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
        <div class="demo-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col">
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <textarea class="mdl-textfield__input" type="text" rows="3" id="target" v-model="text"></textarea>
            <label class="mdl-textfield__label" for="target">日本語を入力する...</label>
          </div>
          <div>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id="translation"
              @click="click()" v-bind:disabled="isPush">
              翻訳
            </button>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" id="clear"
              @click="clear()">
              クリア
            </button>
          </div>
          <div class="demo-spinner">
            <div v-show="loading" class="mdl-spinner mdl-js-spinner is-active"></div>
          </div>
          <div class="demo-text">{{ text }}</div>
          <div class="demo-text">{{ info }}</div>
        </div>
      </div>
      <footer class="demo-footer">
        <div>© 2018 transkonjac</div>
      </footer>
    </main>
  </div>
  <script>
    const baseURL = '/trans_api/index';

    function buildUrl(value) {
      var ret = baseURL + '?text=' + value
      return ret
    };
    new Vue({
      el: '#app',
      data() {
        return {
          text: '',
          info: '',
          isPush: false,
          loading: false,
        }
      },
      methods: {
        click() {
          if (this.text.length > 0) {
            this.loading = true;
            this.isPush = true;
            axios
              .get(buildUrl(this.text))
              .then(response => {
                this.info = response.data.resultset.result.text;
                this.loading = false;
                this.isPush = false;
                var timer = setInterval(function (info) {
                  var voices = speechSynthesis.getVoices();
                  console.log(info);
                  if (info != 0) {
                    var msg = new SpeechSynthesisUtterance(info);
                    msg.voice = voices[1];
                    msg.lang = 'en-US';
                    msg.volume = 1.0;
                    msg.rate = 1.0;
                    msg.pitch = 1.0;
                    speechSynthesis.speak(msg);
                    clearInterval(timer);
                  }
                }, 200, this.info);
              });
          }
        },
        clear() {
          this.text = '';
          this.info = '';
        }
      }
    });
  </script>
</body>

</html>